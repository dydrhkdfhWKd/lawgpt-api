# -*- coding: utf-8 -*-
"""Untitled2.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1kaVgDa9XuteL2W98NBKTL8Gkm8iZXDFA
"""

from flask import Flask, request, jsonify
import xml.etree.ElementTree as ET
from urllib.request import urlopen
import os  # ì—¬ê¸°ì— import ì¶”ê°€

app = Flask(__name__)

@app.route('/')
def home():
    return "ğŸ”¥ LawGPT ì„œë²„ ì‹¤í–‰ ì¤‘ì…ë‹ˆë‹¤!"

@app.route('/law_search', methods=['GET'])
def law_search():
    query = request.args.get('query')
    if not query:
        return jsonify({"error": "No query provided"}), 400

    url = f"http://www.law.go.kr/DRF/lawSearch.do?target=admrul&OC=gogohakj1558&type=XML&query={query}"
    response = urlopen(url).read()
    xtree = ET.fromstring(response)

    results = []
    for i in xtree[8:]:
        law_id = i[0].text
        law_url = f"http://www.law.go.kr/DRF/lawService.do?OC=gogohakj1558&target=admrul&ID={law_id}&type=XML"
        law_response = urlopen(law_url).read()
        law_tree = ET.fromstring(law_response)

        for clause in law_tree[1:]:
            if clause.tag == "ì¡°ë¬¸ë‚´ìš©" and clause.text:
                results.append({
                    "title": law_tree[0][1].text,
                    "content": clause.text
                })
    return jsonify(results)

# ğŸš€ ì—¬ê¸° ì¶”ê°€!
if __name__ == "__main__":
    port = int(os.environ.get("PORT", 5000))  # Railwayì—ì„œ í™˜ê²½ë³€ìˆ˜ë¡œ í¬íŠ¸ ì„¤ì •
    app.run(host='0.0.0.0', port=port)